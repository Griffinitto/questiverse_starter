<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questiverse - Fantasy Kingdom Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            color: #4a5568;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .difficulty-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .difficulty-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .difficulty-card.selected {
            border-color: #4299e1;
            box-shadow: 0 0 20px rgba(66, 153, 225, 0.3);
        }

        .difficulty-card.easy {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
        }

        .difficulty-card.medium {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
        }

        .difficulty-card.hard {
            background: linear-gradient(135deg, #fbb6ce, #f687b3);
        }

        .difficulty-card.non-competitive {
            background: linear-gradient(135deg, #c4b5fd, #a78bfa);
        }

        .difficulty-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }

        .difficulty-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .difficulty-desc {
            font-size: 0.9em;
            color: #4a5568;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .difficulty-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
            color: #2d3748;
        }

        .stat-label {
            font-size: 0.8em;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4299e1;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #718096;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .game-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .level-info {
            text-align: center;
            margin-bottom: 25px;
        }

        .level-title {
            font-size: 1.8em;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .level-description {
            color: #718096;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .game-canvas {
            width: 100%;
            max-width: 600px;
            height: 400px;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            margin: 0 auto;
            display: block;
            background: linear-gradient(45deg, #f7fafc 0%, #edf2f7 100%);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .puzzle-grid {
            display: grid;
            gap: 5px;
            padding: 20px;
            height: 100%;
        }

        .puzzle-grid.easy {
            grid-template-columns: repeat(3, 1fr);
        }

        .puzzle-grid.medium {
            grid-template-columns: repeat(4, 1fr);
        }

        .puzzle-grid.hard {
            grid-template-columns: repeat(5, 1fr);
        }

        .puzzle-grid.non-competitive {
            grid-template-columns: repeat(4, 1fr);
        }

        .puzzle-piece {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .puzzle-piece:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .puzzle-piece.empty {
            background: rgba(255,255,255,0.3);
            border: 2px dashed #cbd5e0;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
            height: 100%;
        }

        .memory-card {
            background: linear-gradient(135deg, #805ad5, #6b46c1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .memory-card.flipped {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .memory-card.matched {
            background: linear-gradient(135deg, #ecc94b, #d69e2e);
            cursor: default;
        }

        .trivia-container {
            padding: 20px;
            text-align: center;
        }

        .question {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #2d3748;
            line-height: 1.5;
        }

        .answer-options {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .answer-btn {
            padding: 15px;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e0);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            color: #2d3748;
        }

        .answer-btn:hover {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            transform: translateY(-2px);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .answer-btn.incorrect {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .kingdom-preview {
            text-align: center;
            margin-bottom: 25px;
        }

        .kingdom-map {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #38a169 0%, #48bb78 50%, #68d391 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .building {
            position: absolute;
            border-radius: 5px;
            transition: all 0.5s ease;
        }

        .castle {
            width: 50px;
            height: 60px;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: #805ad5;
        }

        .cottage {
            width: 30px;
            height: 25px;
            bottom: 20px;
            left: 50px;
            background: #d69e2e;
        }

        .farm {
            width: 40px;
            height: 30px;
            bottom: 15px;
            right: 60px;
            background: #38a169;
        }

        .tower {
            width: 25px;
            height: 50px;
            bottom: 30px;
            right: 30px;
            background: #4299e1;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #e53e3e;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer.non-competitive {
            color: #805ad5;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            transition: width 0.3s ease;
        }

        .leaderboard {
            margin-top: 25px;
        }

        .leaderboard h3 {
            color: #4a5568;
            margin-bottom: 15px;
            text-align: center;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(66, 153, 225, 0.1);
            border-radius: 8px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f56565;
        }

        .guild-info {
            background: linear-gradient(135deg, #805ad5, #6b46c1);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .guild-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .guild-rank {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1001;
            transition: transform 0.3s ease;
        }

        .achievement-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .difficulty-selector {
                grid-template-columns: 1fr 1fr;
            }
            
            .player-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls {
                flex-direction: column;
            }
        }

        .relaxed-mode {
            background: linear-gradient(135deg, #c4b5fd, #a78bfa);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .difficulty-badge.easy {
            background: #38a169;
            color: white;
        }

        .difficulty-badge.medium {
            background: #d69e2e;
            color: white;
        }

        .difficulty-badge.hard {
            background: #e53e3e;
            color: white;
        }

        .difficulty-badge.non-competitive {
            background: #805ad5;
            color: white;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🏰 Questiverse</h1>
            <p>Choose your adventure style and build the greatest fantasy kingdom!</p>
        </div>

        <div class="difficulty-selector">
            <div class="difficulty-card easy" onclick="selectDifficulty('easy')">
                <span class="difficulty-icon">🌱</span>
                <div class="difficulty-title">Easy</div>
                <div class="difficulty-desc">Perfect for beginners and casual play. Simple puzzles with relaxed timing.</div>
                <div class="difficulty-stats">
                    <div class="stat-item">
                        <div class="stat-value">3x3</div>
                        <div class="stat-label">Grid</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">3min</div>
                        <div class="stat-label">Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">+50</div>
                        <div class="stat-label">Gold</div>
                    </div>
                </div>
            </div>

            <div class="difficulty-card medium" onclick="selectDifficulty('medium')">
                <span class="difficulty-icon">⚔️</span>
                <div class="difficulty-title">Medium</div>
                <div class="difficulty-desc">Balanced challenge for regular players. Moderate complexity and timing.</div>
                <div class="difficulty-stats">
                    <div class="stat-item">
                        <div class="stat-value">4x4</div>
                        <div class="stat-label">Grid</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">2min</div>
                        <div class="stat-label">Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">+100</div>
                        <div class="stat-label">Gold</div>
                    </div>
                </div>
            </div>

            <div class="difficulty-card hard" onclick="selectDifficulty('hard')">
                <span class="difficulty-icon">🔥</span>
                <div class="difficulty-title">Hard</div>
                <div class="difficulty-desc">For skilled players seeking a real challenge. Complex puzzles, tight timing.</div>
                <div class="difficulty-stats">
                    <div class="stat-item">
                        <div class="stat-value">5x5</div>
                        <div class="stat-label">Grid</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">90sec</div>
                        <div class="stat-label">Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">+200</div>
                        <div class="stat-label">Gold</div>
                    </div>
                </div>
            </div>

            <div class="difficulty-card non-competitive" onclick="selectDifficulty('non-competitive')">
                <span class="difficulty-icon">🧘</span>
                <div class="difficulty-title">Zen Mode</div>
                <div class="difficulty-desc">Relaxed, no-pressure gameplay. No timers, just pure enjoyment and creativity.</div>
                <div class="difficulty-stats">
                    <div class="stat-item">
                        <div class="stat-value">4x4</div>
                        <div class="stat-label">Grid</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">∞</div>
                        <div class="stat-label">Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">+75</div>
                        <div class="stat-label">Gold</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="player-stats">
            <div class="stat-card">
                <div class="stat-value" id="playerLevel">1</div>
                <div class="stat-label">Level</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="playerXP">0</div>
                <div class="stat-label">Experience</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="playerGold">100</div>
                <div class="stat-label">Gold</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="questsCompleted">0</div>
                <div class="stat-label">Quests</div>
            </div>
        </div>

        <div class="main-content">
            <div class="game-area">
                <div class="level-info">
                    <h2 class="level-title" id="levelTitle">Select a Difficulty to Begin</h2>
                    <span class="difficulty-badge" id="difficultyBadge" style="display: none;"></span>
                    <p class="level-description" id="levelDescription">
                        Choose your preferred challenge level above to start your adventure in Questiverse!
                    </p>
                    <div class="timer" id="gameTimer" style="display: none;">3:00</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="game-canvas" id="gameCanvas" style="display: none;">
                    <div class="puzzle-grid" id="puzzleGrid">
                        <!-- Game content will be generated here -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="startBtn" onclick="startQuest()" style="display: none;">Start Quest</button>
                    <button class="btn btn-secondary" id="resetBtn" onclick="resetQuest()" style="display: none;">Reset</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuest()" style="display: none;">Next Quest</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="guild-info">
                    <div class="guild-name">🛡️ Dragon Slayers</div>
                    <div class="guild-rank">Rank #7 • 342 members</div>
                </div>

                <div id="relaxedModeInfo" class="relaxed-mode" style="display: none;">
                    <div>🧘 Zen Mode Active</div>
                    <div style="font-size: 0.9em; margin-top: 5px;">Take your time, no pressure!</div>
                </div>

                <div class="kingdom-preview">
                    <h3>🏰 Kingdom Progress</h3>
                    <div class="kingdom-map" id="kingdomMap">
                        <div class="building castle"></div>
                        <div class="building cottage" id="cottage" style="opacity: 0;"></div>
                        <div class="building farm" id="farm" style="opacity: 0;"></div>
                        <div class="building tower" id="tower" style="opacity: 0;"></div>
                    </div>
                    <p>Buildings: <span id="buildingCount">1</span>/10</p>
                </div>

                <div class="leaderboard">
                    <h3>🏆 Weekly Champions</h3>
                    <div class="leaderboard-item">
                        <span>🥇 Alex the Great</span>
                        <span>2,450 XP</span>
                    </div>
                    <div class="leaderboard-item">
                        <span>🥈 Maria Quest</span>
                        <span>2,280 XP</span>
                    </div>
                    <div class="leaderboard-item">
                        <span>🥉 You</span>
                        <span id="leaderboardXP">0 XP</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        Quest completed! +50 Gold, +10 XP
    </div>

    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-icon">🏆</div>
        <h3 id="achievementTitle">Achievement Unlocked!</h3>
        <p id="achievementDesc">First Quest Complete</p>
        <button class="btn btn-primary" onclick="closeAchievement()">Awesome!</button>
    </div>

    <script>
        // Game State
        let gameState = {
            difficulty: null,
            currentQuestType: 'puzzle',
            playerLevel: 1,
            playerXP: 0,
            playerGold: 100,
            questsCompleted: 0,
            kingdomBuildings: 1,
            gameActive: false,
            timeLeft: 0,
            puzzleData: [],
            questNumber: 1
        };

        // Difficulty Configurations
        const difficultyConfig = {
            easy: {
                icon: '🌱',
                puzzleSize: 3,
                timeLimit: 180,
                goldReward: 50,
                xpReward: 15,
                questTypes: ['puzzle', 'memory'],
                description: 'Relaxed gameplay perfect for beginners'
            },
            medium: {
                icon: '⚔️',
                puzzleSize: 4,
                timeLimit: 120,
                goldReward: 100,
                xpReward: 25,
                questTypes: ['puzzle', 'memory', 'trivia'],
                description: 'Balanced challenge for regular players'
            },
            hard: {
                icon: '🔥',
                puzzleSize: 5,
                timeLimit: 90,
                goldReward: 200,
                xpReward: 40,
                questTypes: ['puzzle', 'memory', 'trivia', 'reaction'],
                description: 'Intense challenges for skilled players'
            },
            'non-competitive': {
                icon: '🧘',
                puzzleSize: 4,
                timeLimit: null, // No time limit
                goldReward: 75,
                xpReward: 20,
                questTypes: ['puzzle', 'memory', 'creative'],
                description: 'Peaceful, timer-free experience'
            }
        };

        // Quest Data by Type
        const questData = {
            puzzle: {
                title: "The Builder's Puzzle",
                description: "Arrange the pieces to construct buildings for your kingdom!"
            },
            memory: {
                title: "Memory of the Ancients",
                description: "Match the mystical symbols to unlock ancient wisdom!"
            },
            trivia: {
                title: "Scholar's Challenge",
                description: "Answer questions to prove your knowledge and earn rewards!"
            },
            creative: {
                title: "Architect's Vision",
                description: "Design and build without limits in this creative quest!"
            }
        };

        // Trivia Questions by Difficulty
        const triviaQuestions = {
            easy: [
                {
                    question: "What color do you get when you mix red and blue?",
                    answers: ["Purple", "Green", "Orange", "Yellow"],
                    correct: 0
                },
                {
                    question: "How many sides does a triangle have?",
                    answers: ["2", "3", "4", "5"],
                    correct: 1
                }
            ],
            medium: [
                {
                    question: "What is the capital of France?",
                    answers: ["London", "Berlin", "Paris", "Madrid"],
                    correct: 2
                },
                {
                    question: "Which planet is closest to the Sun?",
                    answers: ["Venus", "Mercury", "Earth", "Mars"],
                    correct: 1
                }
            ],
            hard: [
                {
                    question: "What is the chemical symbol for gold?",
                    answers: ["Go", "Gd", "Au", "Ag"],
                    correct: 2
                },
                {
                    question: "In what year did World War II end?",
                    answers: ["1944", "1945", "1946", "1947"],
                    correct: 1
                }
            ]
        };

        // Initialize Game
        function initGame() {
            updateUI();
            resetToSelection();
        }

        function selectDifficulty(difficulty) {
            // Clear previous selection
            document.querySelectorAll('.difficulty-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new difficulty
            document.querySelector(`.difficulty-card.${difficulty}`).classList.add('selected');
            
            gameState.difficulty = difficulty;
            gameState.questNumber = 1;
            
            // Show game area
            document.getElementById('gameCanvas').style.display = 'block';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('resetBtn').style.display = 'inline-block';
            
            // Load first quest
            loadQuest();
            
            // Show zen mode info if non-competitive
            if (difficulty === 'non-competitive') {
                document.getElementById('relaxedModeInfo').style.display = 'block';
                document.getElementById('gameTimer').classList.add('non-competitive');
            } else {
                document.getElementById('relaxedModeInfo').style.display = 'none';
                document.getElementById('gameTimer').classList.remove('non-competitive');
            }
        }

        function loadQuest() {
            if (!gameState.difficulty) return;
            
            const config = difficultyConfig[gameState.difficulty];
            
            // Select quest type based on difficulty and progression
            const availableTypes = config.questTypes;
            const questTypeIndex = (gameState.questNumber - 1) % availableTypes.length;
            gameState.currentQuestType = availableTypes[questTypeIndex];
            
            const quest = questData[gameState.currentQuestType];
            
            // Update UI
            document.getElementById('levelTitle').textContent = `Quest ${gameState.questNumber}: ${quest.title}`;
            document.getElementById('levelDescription').textContent = quest.description;
            
            // Show difficulty badge
            const badge = document.getElementById('difficultyBadge');
            badge.textContent = gameState.difficulty.toUpperCase();
            badge.className = `difficulty-badge ${gameState.difficulty}`;
            badge.style.display = 'inline-block';
            
            // Setup timer
            if (config.timeLimit) {
                gameState.timeLeft = config.timeLimit;
                document.getElementById('gameTimer').textContent = formatTime(config.timeLimit);
                document.getElementById('gameTimer').style.display = 'block';
            } else {
                document.getElementById('gameTimer').textContent = '∞ Zen Mode';
                document.getElementById('gameTimer').style.display = 'block';
            }
            
            // Load appropriate game
            switch (gameState.currentQuestType) {
                case 'puzzle':
                    loadPuzzleGame();
                    break;
                case 'memory':
                    loadMemoryGame();
                    break;
                case 'trivia':
                    loadTriviaGame();
                    break;
                case 'creative':
                    loadCreativeGame();
                    break;
            }
            
            updateUI();
        }

        function loadPuzzleGame() {
            const config = difficultyConfig[gameState.difficulty];
            const size = config.puzzleSize;
            const grid = document.getElementById('puzzleGrid');
            
            // Setup grid
            grid.className = `puzzle-grid ${gameState.difficulty}`;
            grid.innerHTML = '';
            
            // Create puzzle data
            gameState.puzzleData = [];
            for (let i = 1; i < size * size; i++) {
                gameState.puzzleData.push(i);
            }
            gameState.puzzleData.push(null); // Empty space
            
            // Shuffle puzzle
            shufflePuzzle();
            renderPuzzle();
        }

        function loadMemoryGame() {
            const grid = document.getElementById('puzzleGrid');
            grid.className = 'memory-grid';
            grid.innerHTML = '';
            
            // Create memory cards (8 pairs)
            const symbols = ['🌟', '🔥', '💎', '⚡', '🌙', '🦄', '🏰', '⚔️'];
            const cards = [...symbols, ...symbols]; // Duplicate for pairs
            
            // Shuffle cards
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            gameState.memoryCards = cards.map((symbol, index) => ({
                symbol,
                flipped: false,
                matched: false,
                index
            }));
            
            gameState.flippedCards = [];
            gameState.matchedPairs = 0;
            
            renderMemoryGame();
        }

        function loadTriviaGame() {
            const grid = document.getElementById('puzzleGrid');
            grid.className = 'trivia-container';
            grid.innerHTML = '';
            
            // Get questions for current difficulty
            const questions = triviaQuestions[gameState.difficulty] || triviaQuestions.easy;
            gameState.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            gameState.questionAnswered = false;
            
            renderTriviaGame();
        }

        function loadCreativeGame() {
            const grid = document.getElementById('puzzleGrid');
            grid.className = 'puzzle-grid non-competitive';
            grid.innerHTML = '';
            
            // Create a simple creative building interface
            const creativeContent = document.createElement('div');
            creativeContent.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3>🎨 Creative Mode</h3>
                    <p>Click the blocks below to design your building!</p>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px;">
                        ${Array.from({length: 16}, (_, i) => `
                            <div class="creative-block" onclick="toggleCreativeBlock(${i})" 
                                 style="width: 50px; height: 50px; background: #e2e8f0; border: 2px solid #cbd5e0; 
                                        border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"></div>
                        `).join('')}
                    </div>
                    <button class="btn btn-primary" onclick="completeCreativeQuest()" style="margin-top: 20px;">
                        Complete Creation
                    </button>
                </div>
            `;
            
            grid.appendChild(creativeContent);
            gameState.creativeBlocks = Array(16).fill(false);
        }

        function shufflePuzzle() {
            const size = Math.sqrt(gameState.puzzleData.length);
            
            // Perform valid moves to ensure solvability
            for (let i = 0; i < 1000; i++) {
                const emptyIndex = gameState.puzzleData.indexOf(null);
                const validMoves = getValidMoves(emptyIndex);
                const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                
                [gameState.puzzleData[emptyIndex], gameState.puzzleData[randomMove]] = 
                [gameState.puzzleData[randomMove], gameState.puzzleData[emptyIndex]];
            }
        }

        function renderPuzzle() {
            const grid = document.getElementById('puzzleGrid');
            grid.innerHTML = '';
            
            gameState.puzzleData.forEach((piece, index) => {
                const pieceElement = document.createElement('div');
                pieceElement.className = 'puzzle-piece';
                
                if (piece === null) {
                    pieceElement.classList.add('empty');
                } else {
                    pieceElement.textContent = piece;
                    pieceElement.onclick = () => movePiece(index);
                }
                
                grid.appendChild(pieceElement);
            });
        }

        function renderMemoryGame() {
            const grid = document.getElementById('puzzleGrid');
            grid.innerHTML = '';
            
            gameState.memoryCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'memory-card';
                
                if (card.flipped || card.matched) {
                    cardElement.textContent = card.symbol;
                    cardElement.classList.add(card.matched ? 'matched' : 'flipped');
                } else {
                    cardElement.textContent = '?';
                    cardElement.onclick = () => flipCard(index);
                }
                
                grid.appendChild(cardElement);
            });
        }

        function renderTriviaGame() {
            const grid = document.getElementById('puzzleGrid');
            const question = gameState.currentQuestion;
            
            grid.innerHTML = `
                <div class="question">${question.question}</div>
                <div class="answer-options">
                    ${question.answers.map((answer, index) => `
                        <button class="answer-btn" onclick="selectAnswer(${index})">${answer}</button>
                    `).join('')}
                </div>
            `;
        }

        function movePiece(index) {
            if (!gameState.gameActive) return;
            
            const emptyIndex = gameState.puzzleData.indexOf(null);
            const validMoves = getValidMoves(emptyIndex);
            
            if (validMoves.includes(index)) {
                [gameState.puzzleData[index], gameState.puzzleData[emptyIndex]] = 
                [gameState.puzzleData[emptyIndex], gameState.puzzleData[index]];
                
                renderPuzzle();
                checkPuzzleWin();
            }
        }

        function flipCard(index) {
            if (!gameState.gameActive || gameState.memoryCards[index].flipped || 
                gameState.memoryCards[index].matched || gameState.flippedCards.length >= 2) return;
            
            gameState.memoryCards[index].flipped = true;
            gameState.flippedCards.push(index);
            
            renderMemoryGame();
            
            if (gameState.flippedCards.length === 2) {
                setTimeout(checkMemoryMatch, 1000);
            }
        }

        function checkMemoryMatch() {
            const [first, second] = gameState.flippedCards;
            
            if (gameState.memoryCards[first].symbol === gameState.memoryCards[second].symbol) {
                gameState.memoryCards[first].matched = true;
                gameState.memoryCards[second].matched = true;
                gameState.matchedPairs++;
                
                if (gameState.matchedPairs === 8) {
                    completeQuest();
                }
            } else {
                gameState.memoryCards[first].flipped = false;
                gameState.memoryCards[second].flipped = false;
            }
            
            gameState.flippedCards = [];
            renderMemoryGame();
        }

        function selectAnswer(answerIndex) {
            if (gameState.questionAnswered) return;
            
            gameState.questionAnswered = true;
            const correct = answerIndex === gameState.currentQuestion.correct;
            
            // Update button styles
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, index) => {
                if (index === gameState.currentQuestion.correct) {
                    btn.classList.add('correct');
                } else if (index === answerIndex && !correct) {
                    btn.classList.add('incorrect');
                }
                btn.disabled = true;
            });
            
            setTimeout(() => {
                if (correct) {
                    completeQuest();
                } else {
                    showNotification("Incorrect! Try again!", 'error');
                    setTimeout(() => {
                        resetQuest();
                    }, 2000);
                }
            }, 1500);
        }

        function toggleCreativeBlock(index) {
            gameState.creativeBlocks[index] = !gameState.creativeBlocks[index];
            const block = document.querySelectorAll('.creative-block')[index];
            
            if (gameState.creativeBlocks[index]) {
                block.style.background = 'linear-gradient(135deg, #4299e1, #3182ce)';
                block.style.borderColor = '#3182ce';
            } else {
                block.style.background = '#e2e8f0';
                block.style.borderColor = '#cbd5e0';
            }
        }

        function completeCreativeQuest() {
            completeQuest();
        }

        function getValidMoves(emptyIndex) {
            const size = Math.sqrt(gameState.puzzleData.length);
            const validMoves = [];
            const row = Math.floor(emptyIndex / size);
            const col = emptyIndex % size;
            
            if (row > 0) validMoves.push(emptyIndex - size);
            if (row < size - 1) validMoves.push(emptyIndex + size);
            if (col > 0) validMoves.push(emptyIndex - 1);
            if (col < size - 1) validMoves.push(emptyIndex + 1);
            
            return validMoves;
        }

        function checkPuzzleWin() {
            const size = Math.sqrt(gameState.puzzleData.length);
            
            for (let i = 0; i < size * size - 1; i++) {
                if (gameState.puzzleData[i] !== i + 1) return false;
            }
            
            if (gameState.puzzleData[size * size - 1] === null) {
                completeQuest();
                return true;
            }
            return false;
        }

        function startQuest() {
            gameState.gameActive = true;
            const config = difficultyConfig[gameState.difficulty];
            
            if (config.timeLimit) {
                gameState.timeLeft = config.timeLimit;
                
                const timer = setInterval(() => {
                    gameState.timeLeft--;
                    document.getElementById('gameTimer').textContent = formatTime(gameState.timeLeft);
                    
                    if (gameState.timeLeft <= 0) {
                        clearInterval(timer);
                        failQuest();
                    }
                    
                    if (!gameState.gameActive) {
                        clearInterval(timer);
                    }
                }, 1000);
            }
            
            document.getElementById('startBtn').style.display = 'none';
        }

        function completeQuest() {
            gameState.gameActive = false;
            const config = difficultyConfig[gameState.difficulty];
            
            // Award rewards
            gameState.playerGold += config.goldReward;
            gameState.playerXP += config.xpReward;
            gameState.questsCompleted++;
            
            // Add building to kingdom
            addKingdomBuilding();
            
            // Show notification
            showNotification(`Quest completed! +${config.goldReward} Gold, +${config.xpReward} XP`);
            
            // Check for level up
            checkLevelUp();
            
            // Show next button
            document.getElementById('nextBtn').style.display = 'inline-block';
            
            updateUI();
        }

        function failQuest() {
            gameState.gameActive = false;
            showNotification("Time's up! Try again!", 'error');
            document.getElementById('startBtn').style.display = 'inline-block';
        }

        function resetQuest() {
            gameState.gameActive = false;
            loadQuest();
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
        }

        function nextQuest() {
            gameState.questNumber++;
            loadQuest();
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('startBtn').style.display = 'inline-block';
        }

        function resetToSelection() {
            gameState.difficulty = null;
            gameState.questNumber = 1;
            
            document.getElementById('gameCanvas').style.display = 'none';
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('gameTimer').style.display = 'none';
            document.getElementById('difficultyBadge').style.display = 'none';
            document.getElementById('relaxedModeInfo').style.display = 'none';
            
            document.getElementById('levelTitle').textContent = 'Select a Difficulty to Begin';
            document.getElementById('levelDescription').textContent = 'Choose your preferred challenge level above to start your adventure in Questiverse!';
            
            document.querySelectorAll('.difficulty-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        function addKingdomBuilding() {
            gameState.kingdomBuildings++;
            
            const buildings = ['cottage', 'farm', 'tower'];
            const buildingIndex = (gameState.questsCompleted - 1) % buildings.length;
            const buildingId = buildings[buildingIndex];
            
            const building = document.getElementById(buildingId);
            if (building) {
                building.style.opacity = '1';
            }
            
            document.getElementById('buildingCount').textContent = gameState.kingdomBuildings;
        }

        function checkLevelUp() {
            const xpForNextLevel = gameState.playerLevel * 100;
            if (gameState.playerXP >= xpForNextLevel) {
                gameState.playerLevel++;
                gameState.playerXP -= xpForNextLevel;
                showAchievement("Level Up!", `Welcome to level ${gameState.playerLevel}! Your kingdom grows stronger!`);
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showAchievement(title, description) {
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            document.getElementById('achievementPopup').classList.add('show');
        }

        function closeAchievement() {
            document.getElementById('achievementPopup').classList.remove('show');
        }

        function updateUI() {
            document.getElementById('playerLevel').textContent = gameState.playerLevel;
            document.getElementById('playerXP').textContent = gameState.playerXP;
            document.getElementById('playerGold').textContent = gameState.playerGold;
            document.getElementById('questsCompleted').textContent = gameState.questsCompleted;
            document.getElementById('leaderboardXP').textContent = gameState.playerXP + ' XP';
            
            // Update progress bar
            const progress = Math.min(gameState.questsCompleted / 10 * 100, 100);
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Initialize game when page loads
        window.onload = initGame;
    </script>
</body>
</html>